# Build Guide

![picot_r40_main00](/images/main_00.jpg)

picot_R40のビルドガイドになります。  

picot_R40は、マイコン+トラックボールモジュールであるpicot5400を活用したロウスタッガード40%キーボードです。中央のトラックボールは25mm、34mmどちらにも対応可能です。専用の3Dプリントケースが用意されています。  
まず始めにこのビルドガイドを最後までよく読み、必要なものを揃えた上で組み立てに取り掛かってください。


## 部品
### キット付属品

|名前|数|備考|
|---|---|---|
|メインPCB|1枚||
|スイッチプレート|1枚||
|picot5400|1枚||
|Unified Daughter Board|1個||
|マウスセンサー（PMW3360）|1個||
|JSTケーブル|1本||
|FFC|1本||
|[THQWGD001](https://github.com/Taro-Hayashi/THQWGD001)*|3||
|スイッチソケット|40||
|M2スペーサー 3.5mm|16個||
|M2ねじ 3mm|24本||
|M2ねじ 5mm|14本||
|M2ナット|6||
|ゴム脚|4個||
|ベアリングローラー|3個||
|ステンレス丸棒|3本||
|シリコンチューブ（細）|1本||
|シリコンチューブ（太）|1本||
|マグネット|8個||
|3Dプリントケース|1個||
|3Dプリントボールケース（ベース・カバー）|各1個||

*THQWGD001ははやしたろう様設計の水平ホイールエンコーダです。本キット用に調整したものをキットに同梱しています。

### キット以外に必要なもの

|名前|数|備考|
|---|---|---|
|キースイッチ|最大40個|MX互換|
|キーキャップ|最大40個|MX互換|
|2Uスタビライザー|2～3個||
|トラックボール（34mm or 25mmボール）|1個||
|USB-TypeCケーブル|1本||


## 組み立て
### 部品確認

  まずはキット付属品に記載されたパーツが揃っているか確認ください。  
  その他上述の「キット以外に必要なもの」を揃えた上で組み立てに取り掛かってください。

  - タブ付きPCBの場合にはタブを割って切り離し、切断面を軽くヤスリがけしてください。


### picot5400

  まず[picot5400のビルドガイド](https://github.com/aki27kbd/picot5400/blob/main/doc/buildguide.md)を確認し、picot5400関係のはんだ付けと組み立てを行ってください。  

### メインPCB

  まずスイッチソケットのはんだ付けを行います。  
  マルチレイアウトに対応しているエンターキー廻りのソケット（SW10、SW10-2）は、どちらか一つのレイアウトを選択してはんだ付けをしてください。  
  ISOエンター用ソケット（SW10）
  ![picot_r40_bg_pcb_1](/images/bg_pcb_1.jpg)  

  1.5U BS + 1.25Uエンター用ソケット（SW10-2）
  ![picot_r40_bg_pcb_2](/images/bg_pcb_2.jpg)  

  スクロールホイールのはんだ付けを行います。  
  エンコーダをPCBの表から挿し、裏側からはんだ付けを行います。
  ![picot_r40_bg_pcb_3](/images/bg_pcb_3.jpg)  

  ホイールにシャフトを嵌め込みます。  
  ![picot_r40_bg_pcb_4](/images/bg_pcb_4.jpg)  

  ホイールに嵌め込んだシャフトをはんだ付けしたエンコーダに挿し込みます。  
  ![picot_r40_bg_pcb_5](/images/bg_pcb_5.jpg)  

  ベースパーツをエンコーダの反対側に挿し込みます。    
  ![picot_r40_bg_pcb_6](/images/bg_pcb_6.jpg)  

  M2ナットとM2ねじ（5mm）でベースパーツを固定します。
  ![picot_r40_bg_pcb_7](/images/bg_pcb_7.jpg)  

  エンコーダにカバーを被せます。この工程を3個分行います。  
  ![picot_r40_bg_pcb_8](/images/bg_pcb_8.jpg)  

  これ以降の行程はpicot_O44と共通になるので、[picot_O44のビルドガイド](https://github.com/aki27kbd/picot_o44/blob/main/doc/buildguide.md)を参照してください。


### ファームウェア

  デフォルトのファームが書き込まれた状態でお届けしています。ご自分でファームを書き込む場合、下記手順の通り実行してください。

  - picot5400のBOOTボタンを押しながらRESETボタンを押し、ブートローダーモードに入ります。
  - その状態でRPI-RP2というドライブに[.uf2](https://github.com/aki27kbd/picot_r40/blob/main/firmware/aki27_picot_r40_vial.uf2)ファイルをドラッグ&ドロップすることでファームが書き込まれます。　　

  キーマップは[vial](https://vial.rocks/)から更新可能です。  
  トラックボールの動作は後述のセンサー基板を組み立ててから行ってください。  
  ![vial](/images/vial.jpg)

  デフォルトのファームウェアでは自動マウスレイヤー機能がオンになっています。この機能では、トラックボールを動かすと自動的にマウスレイヤー（レイヤー4）に移動することが可能です。カスタムキーコード（`AM_TOG`）を押すことで自動マウスレイヤー機能のオンオフを切り替えられます。

  ソースコードは[こちら](https://github.com/aki27kbd/vial-qmk/tree/vial/keyboards/aki27/picot_r40)を参照ください。      


## カスタムキーコード

  トラックボールの操作に関していくつかカスタムキーコードを設定することが可能です。（SCRL_MOはレイヤー4でのみ有効）

  Keycode   |Description
  ---------|-----------
  `CPI_SW`  |トラックボールのCPIを変更します。デフォルトのファームウェアでは、押すたびに200→400→800→1600→3200→200…という順番でCPIが変わります。
  `SCRL_SW` |スクロールモードにおけるセンサーの感度を変更します。数値が大きいほどスクロール量が小さくなります。
  `ROT_R15` |マウスセンサーのＹ軸を時計回りに15度回転させます。
  `ROT_L15` |マウスセンサーのＹ軸を反時計回りに15度回転させます。
  `SCRL_MO` |押されている間スクロールモードになります。（デフォルトファームではレイヤー4でのみ有効）
  `SCRL_TO` |押すたびにスクロールモードとマウスモードを切り替えます。（デフォルトファームでは無効）
  `SCRL_IN` |スクロール方向を反転させます。
  `AM_TOG` |自動マウスレイヤー切り替えのオンオフを切り替えます。

  vialでカスタムキーコードを設定する場合はUserタブ下のカスタムキーコードを用いて設定することが可能です。  
  ![CustomKeycode_rev](/images/bg_customkeycode.jpg)


## 終わりに
何かトラブルがあれば[Twitterアカウント](https://twitter.com/aki27kbd)までご連絡ください。

また、完成写真をSNSにアップいただけるととても励みになります。（アップするのがはばかられる方はDMで直接送りつけていただいても構いません。）

ハッシュタグは #picot_r40 です。
